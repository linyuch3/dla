# CloudPanel Telegram Bot 使用手册

本手册介绍如何使用 CloudPanel 的 Telegram Bot 来管理您的云服务器。

## 🚀 快速开始

### 1. 配置 Bot

**方法一：使用现有的 webhook 处理器**
- 现有的 `functions/api/telegram/webhook.ts` 已经支持基本功能
- 支持管理员和用户分离的 Bot Token

**方法二：使用新的增强版处理器**
- 使用 `functions/api/telegram/bot-webhook.ts` 获得完整功能
- 支持完整的命令化界面和多轮表单

### 2. 设置 Webhook

将您的 Bot webhook 指向：
```
https://your-domain.com/api/telegram/webhook
```

或使用新的增强版处理器：
```
https://your-domain.com/api/telegram/bot-webhook
```

## 📱 可用命令

### 基础命令

| 命令 | 功能 | 描述 |
|------|------|------|
| `/start` | 主菜单 | 显示欢迎信息和主菜单 |
| `/help` | 帮助信息 | 查看所有可用命令和功能说明 |

### 实例管理

| 命令 | 功能 | 描述 |
|------|------|------|
| `/instances` | 实例列表 | 查看所有云服务器实例 |
| `/create` | 创建实例 | 启动创建新实例的向导 |

### 密钥管理

| 命令 | 功能 | 描述 |
|------|------|------|
| `/keys` | 密钥管理 | 查看和管理 API 密钥 |

### 账户信息

| 命令 | 功能 | 描述 |
|------|------|------|
| `/account` | 账户信息 | 查看当前账户余额和使用情况 |

## 🎮 功能详解

### 实例管理功能

#### 查看实例列表
- 📦 显示所有实例的概览
- 显示状态、地区、IP地址等关键信息
- 支持分页浏览（每页5个实例）
- 点击实例名称查看详细信息

#### 实例详情和操作
- 📊 显示完整的实例配置信息
- ⚡ 实例控制：启动、关机、重启
- 🔄 IP管理：更换IPv4/IPv6地址
- 🗑 删除实例（需要二次确认）
- 🔄 实时状态刷新

#### 创建新实例
**6步向导流程：**

1. **选择地区** - 从可用地区中选择服务器位置
2. **选择镜像** - 选择操作系统（Ubuntu、CentOS、Debian等）
3. **选择配置** - 选择CPU、内存、硬盘规格
4. **设置数量** - 选择创建1-10个实例
5. **配置选项** - 设置实例名称、密码、IPv6等
6. **确认创建** - 检查配置并提交创建

**高级功能：**
- 🏷 自定义实例名称或自动生成
- 🔐 自定义root密码或随机生成
- 🌐 可选择启用IPv6
- 📊 批量创建（最多10个实例）

### 密钥管理功能

#### 查看密钥列表
- 🔑 显示所有已添加的API密钥
- 标记当前使用的密钥
- 显示云服务商和创建时间
- 支持分页浏览

#### 密钥详情
- 📋 显示密钥的基本信息
- ✅ 设置为当前使用密钥
- 🗑 删除密钥（需确认）

#### 添加新密钥（开发中）
支持的云服务商：
- 🌊 **DigitalOcean** - 需要Personal Access Token
- 🔗 **Linode** - 需要API Token
- ☁️ **Microsoft Azure** - 支持两种配置方式：
  - 分别输入：Client ID、Client Secret、Tenant ID、Subscription ID
  - JSON配置：粘贴完整的Azure配置JSON

### 账户信息功能

#### 账户概览
- 💰 显示当前余额
- 📊 显示实例数量和配额
- 💳 显示本月使用情况
- 🔑 显示当前使用的API密钥

## 🎯 使用技巧

### 交互方式

1. **命令输入**
   - 直接输入命令（如 `/instances`）
   - 或使用 `/start` 进入菜单模式

2. **内联按钮**
   - 点击消息下方的按钮进行操作
   - 支持分页浏览和快速导航

3. **多轮表单**
   - 创建实例时按步骤进行
   - 可随时返回上一步修改
   - 支持取消操作

### 状态管理

- ✅ **操作状态回显** - 所有操作都有明确的成功/失败反馈
- ⏳ **进度提示** - 长时间操作显示进行中状态
- 🔄 **刷新功能** - 可随时刷新状态和数据
- ⚠️ **错误处理** - 友好的错误提示和重试选项

### 安全特性

- 🔐 **权限验证** - 严格的用户身份验证
- 🛡 **数据隔离** - 用户只能访问自己的资源
- 🔒 **安全操作** - 危险操作需要二次确认
- 🕒 **会话管理** - 自动过期的临时状态

## ⚠️ 注意事项

### 使用限制

1. **网络延迟** - 某些操作可能需要几秒钟时间
2. **会话过期** - 长时间无操作会话将过期（30分钟）
3. **操作限制** - 部分高级功能仍在开发中

### 最佳实践

1. **定期刷新** - 长时间使用时定期刷新状态
2. **确认操作** - 重要操作前仔细检查
3. **备份重要数据** - 删除实例前确保数据已备份

### 故障排除

**Bot 无响应：**
- 检查 Bot Token 配置
- 确认 webhook 设置正确
- 查看服务器日志

**权限错误：**
- 确认已在CloudPanel中配置Telegram通知
- 检查User ID是否正确
- 验证API密钥有效性

**操作失败：**
- 检查账户余额
- 确认API密钥权限
- 重试操作或联系管理员

## 🔄 更新和维护

### 功能路线图

- ✅ 基础实例管理
- ✅ 创建实例向导
- 🚧 完整密钥管理（开发中）
- 🚧 高级实例操作（开发中）
- 📋 计划中：监控和告警功能

### 反馈和支持

如遇到问题或有功能建议：
1. 查看CloudPanel日志
2. 检查Telegram Bot API响应
3. 联系管理员获取技术支持

---

📱 **享受便捷的云服务器管理体验！**

