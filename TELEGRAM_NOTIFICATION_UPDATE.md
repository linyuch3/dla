# Telegram é€šçŸ¥åŠŸèƒ½æ›´æ–°è¯´æ˜Ž

## ðŸ“¢ æ–°å¢žé€šçŸ¥ç±»åž‹

çŽ°åœ¨ CloudPanel æ”¯æŒä»¥ä¸‹æ‰€æœ‰é‡è¦æ“ä½œçš„ Telegram é€šçŸ¥ï¼š

### 1. å®žä¾‹æ“ä½œé€šçŸ¥
- âœ… **åˆ›å»ºå®žä¾‹** - æ˜¾ç¤ºå®žä¾‹åç§°ã€æä¾›å•†ã€åŒºåŸŸã€IPåœ°å€
- â–¶ï¸ **å¼€æœº** - æ˜¾ç¤ºå®žä¾‹åç§°ã€æä¾›å•†ã€IPåœ°å€
- â¹ï¸ **å…³æœº** - æ˜¾ç¤ºå®žä¾‹åç§°ã€æä¾›å•†ã€IPåœ°å€
- ðŸ”„ **é‡å¯** - æ˜¾ç¤ºå®žä¾‹åç§°ã€æä¾›å•†ã€IPåœ°å€
- ðŸ—‘ï¸ **åˆ é™¤å®žä¾‹** - æ˜¾ç¤ºå®žä¾‹åç§°ã€æä¾›å•†

### 2. IP æ›´æ¢é€šçŸ¥
- ðŸ”€ **æ›´æ¢IP** - æ˜¾ç¤ºå®žä¾‹åç§°ã€æä¾›å•†ã€æ—§IPã€æ–°IP

### 3. è‡ªåŠ¨è¡¥æœºé€šçŸ¥
- ðŸš€ **è‡ªåŠ¨è¡¥æœº** - æ˜¾ç¤ºæ–°å®žä¾‹åç§°ã€æä¾›å•†ã€åŒºåŸŸã€IPåœ°å€ã€ä»»åŠ¡åç§°

### 4. API å¯†é’¥å¥åº·é€šçŸ¥
- ðŸ”´ **APIå¯†é’¥å¤±æ•ˆ** - æ˜¾ç¤ºå¯†é’¥åç§°ã€æä¾›å•†ã€é”™è¯¯ä¿¡æ¯
- ðŸŸ¡ **APIå¯†é’¥å—é™** - æ˜¾ç¤ºå¯†é’¥åç§°ã€æä¾›å•†ã€é™åˆ¶è¯¦æƒ…

## ðŸ• å®šæ—¶ä»»åŠ¡

### 1. å®šæ—¶ API å¯†é’¥æµ‹è¯•
- **é¢‘çŽ‡**: æ¯ 6 å°æ—¶ä¸€æ¬¡ï¼ˆ00:00, 06:00, 12:00, 18:00 UTCï¼‰
- **åŠŸèƒ½**: è‡ªåŠ¨æµ‹è¯•æ‰€æœ‰ç”¨æˆ·çš„ API å¯†é’¥å¥åº·çŠ¶æ€
- **é€šçŸ¥**: æ£€æµ‹åˆ°å¤±æ•ˆæˆ–å—é™çš„å¯†é’¥æ—¶è‡ªåŠ¨å‘é€ Telegram é€šçŸ¥

### 2. æ¯æ—¥å¥åº·æ£€æŸ¥
- **é¢‘çŽ‡**: æ¯å¤©é…ç½®çš„æ—¶é—´ï¼ˆé»˜è®¤ 09:00 UTCï¼‰
- **åŠŸèƒ½**: æ£€æŸ¥æ‰€æœ‰ API å¯†é’¥å¥åº·çŠ¶æ€å¹¶å‘é€æ±‡æ€»æŠ¥å‘Š

## ðŸ”§ ä¿®å¤é—®é¢˜

### 1. test-health ç«¯ç‚¹ 404 é”™è¯¯
- **é—®é¢˜**: å‰ç«¯è°ƒç”¨ POST /api/apikeys/test-health è¿”å›ž 404
- **åŽŸå› **: è·¯ç”±æ³¨å†Œä¸º GET æ–¹æ³•ï¼Œä½†å‰ç«¯ä½¿ç”¨ POST
- **ä¿®å¤**: æ›´æ–°è·¯ç”±æ³¨å†Œä¸º POST æ–¹æ³•

## ðŸ“ ä½¿ç”¨è¯´æ˜Ž

### å¯ç”¨ Telegram é€šçŸ¥

1. æ‰“å¼€**ç”¨æˆ·è®¾ç½®**
2. é…ç½® **Telegram Bot Token** å’Œ **User ID**
3. å¼€å¯ **å¯ç”¨é€šçŸ¥** å¼€å…³
4. ä¿å­˜è®¾ç½®

### é€šçŸ¥æ¶ˆæ¯æ ¼å¼

æ‰€æœ‰é€šçŸ¥æ¶ˆæ¯éƒ½é‡‡ç”¨ç»Ÿä¸€æ ¼å¼ï¼ŒåŒ…å«ï¼š
- ðŸ”” æ“ä½œå›¾æ ‡
- â° æ—¶é—´æˆ³ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
- ðŸ“‹ æ“ä½œç±»åž‹å’Œè¯¦æƒ…
- ðŸ·ï¸ ç›¸å…³èµ„æºä¿¡æ¯

### ç¤ºä¾‹æ¶ˆæ¯

```
ðŸ†• *CloudPanel é€šçŸ¥*

â° æ—¶é—´: 2026-01-01 17:30:00
ðŸ“¦ æ“ä½œ: åˆ›å»ºå®žä¾‹
ðŸ·ï¸ å®žä¾‹: do-auto-123456
â˜ï¸ æä¾›å•†: digitalocean
ðŸŒ åŒºåŸŸ: sgp1
ðŸŒ IP: `192.168.1.100`
```

## ðŸŽ¯ æŠ€æœ¯å®žçŽ°

### æ–°å¢žæ–‡ä»¶
- `functions/shared/telegram-notify.ts` - Telegram é€šçŸ¥è¾…åŠ©å‡½æ•°

### ä¿®æ”¹æ–‡ä»¶
1. **functions/routes/index.ts**
   - ä¿®å¤ test-health è·¯ç”±æ–¹æ³•ä¸º POST

2. **functions/api/instances/index.ts**
   - æ·»åŠ åˆ›å»ºå®žä¾‹çš„é€šçŸ¥

3. **functions/api/instances/[id]/action.ts**
   - æ·»åŠ å¼€æœºã€å…³æœºã€é‡å¯çš„é€šçŸ¥

4. **functions/api/instances/[id]/change-ip.ts**
   - æ·»åŠ æ›´æ¢IPçš„é€šçŸ¥

5. **functions/api/instances/[id]/index.ts**
   - æ·»åŠ åˆ é™¤å®žä¾‹çš„é€šçŸ¥

6. **functions/api/auto-replenish/trigger.ts**
   - æ·»åŠ è‡ªåŠ¨è¡¥æœºçš„é€šçŸ¥

7. **functions/api/apikeys/test-health.ts**
   - æ·»åŠ APIå¯†é’¥å¤±æ•ˆå’Œå—é™çš„é€šçŸ¥

8. **functions/scheduler.ts**
   - æ–°å¢ž `scheduleApiKeyTest()` å®šæ—¶æµ‹è¯•å‡½æ•°
   - æ¯ 6 å°æ—¶è‡ªåŠ¨æµ‹è¯•æ‰€æœ‰ API å¯†é’¥

9. **functions/server.ts**
   - å¯åŠ¨å®šæ—¶ API å¯†é’¥æµ‹è¯•ä»»åŠ¡

## âš™ï¸ é…ç½®é€‰é¡¹

å®šæ—¶ä»»åŠ¡éœ€è¦åœ¨ `config.ts` ä¸­é…ç½® Telegram å‚æ•°ï¼š
```typescript
telegram: {
  botToken: process.env.TELEGRAM_BOT_TOKEN,
  adminId: process.env.TELEGRAM_ADMIN_ID
}
```

## ðŸ” è°ƒè¯•

æŸ¥çœ‹é€šçŸ¥å‘é€æ—¥å¿—ï¼š
```bash
docker logs cloudpanel 2>&1 | grep -i telegram
```

æŸ¥çœ‹å®šæ—¶ä»»åŠ¡æ‰§è¡Œï¼š
```bash
docker logs cloudpanel 2>&1 | grep -E "(å®šæ—¶|APIå¯†é’¥æµ‹è¯•)"
```
